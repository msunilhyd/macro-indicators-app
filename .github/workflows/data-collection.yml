name: Automated Data Collection

on:
  schedule:
    # Run at 9 AM, 3 PM, 9 PM UTC daily
    - cron: '0 9 * * *'   # 9 AM
    - cron: '0 15 * * *'  # 3 PM  
    - cron: '0 21 * * *'  # 9 PM
  workflow_dispatch:      # Allow manual trigger

jobs:
  collect-data:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Data Collection
        run: |
          echo "üöÄ Starting data collection at $(date)"
          response=$(curl -s -w "%{http_code}" -X POST \
            "https://macro-indicators-app-production.up.railway.app/api/admin/collect-all-data?admin_token=admin")
          
          http_code="${response: -3}"
          body="${response%???}"
          
          if [ "$http_code" -eq 200 ]; then
            echo "‚úÖ Data collection successful"
            echo "$body" | jq .
          else
            echo "‚ùå Data collection failed with HTTP $http_code"
            echo "$body"
            exit 1
          fi